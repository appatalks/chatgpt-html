<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Eva - ChatGPT</title>

  <!-- Optional local config override (prevents file:// fetch issues) -->
  <script src="config.local.js"></script>
  <!-- Scripts -->
  <script src="core/js/options.js"></script> 
  <script src="core/js/external.js"></script>
  <script src="core/js/gpt-core.js"></script>
  <script src="core/js/gl-google.js"></script>
  <script src="core/js/lm-studio.js"></script>
  <script src="core/js/copilot.js"></script>
  <script src="core/js/dalle3.js"></script>
  <script src="core/js/aws-sdk-2.1304.0.min.js"></script>
  <script>
    auth();
    // Adjust for Mobile User Agents
    mobile_txtout();
  </script>

  <!-- Original CSS -->
  <link rel="stylesheet" type="text/css" href="core/style.css">

</head>

<body onload="OnLoad()">
  <script>
    // Adjust for Mobile User Agents
    useragent_adjust();
  </script>

  
  
  <!-- LCARS Left Sidebar (shown in LCARS theme) -->
  <nav id="lcarsSidebar" aria-label="LCARS sidebar">
    <div class="lcars-rail" aria-hidden="true"></div>
    <!-- Decorative LCARS chips -->
    <div class="lcars-chip" id="lcarsChipTop"></div>
    <div class="lcars-chip peach" id="lcarsChipPeach">
      <button id="sidebarSettingsBtn" type="button" title="Settings">Settings</button>
    </div>
    <div class="lcars-chip red" id="lcarsChipRed">
      <button id="sidebarClearBtn" type="button" title="Clear Memory">Clear</button>
    </div>
    <div class="lcars-chip sand" id="lcarsChipSand">
      <!-- Speak button will be moved here at runtime in LCARS -->
    </div>

  <div class="lcars-chip print" id="lcarsChipPrint">
      <!-- Print button will be moved here at runtime in LCARS -->
    </div>

    

    <div class="lcars-label" aria-hidden="true">Access • 49204.3</div>
  </nav>

  <div id="idContainer">
    <div id="textToSynth">
      <!-- Chat Output Area -->
      <div id="txtOutput" rows="10" wrap="soft" placeholder="Output">
        <!-- Example Chat Messages -->
        <div class="chat-message user">
          <div class="bubble">Hi there, how's your day going?<div class="bubble-time">9:00 AM</div>
          </div>
        </div>
        <div class="chat-message eva">
          <div class="bubble">Busy but good! Working on some code. You?<div class="bubble-time">9:02 AM</div>
          </div>
        </div>
        <div class="chat-message user">
          <div class="bubble">Same here! Let's catch up later.<div class="bubble-time">9:05 AM</div>
          </div>
        </div>
      </div>

      <div class="container">
        <button class="speakSend" aria-label="Speak the text"
                onClick="speakText(); document.getElementById('audioPlayback').setAttribute('autoplay', true);"
                id="speakSend" title="Speak This">
        </button>
      </div>


  <!-- Settings Overlay -->
  <div class="settings-overlay" id="settingsOverlay"></div>

  <!-- Settings Panel (tabbed) -->
  <div class="settingsMenu" id="settingsMenu">
    <div class="settings-header">
      <h3>Settings</h3>
      <button class="settings-close" id="settingsClose" type="button" aria-label="Close settings">&times;</button>
    </div>
    <div class="settings-tabs" role="tablist">
      <button class="settings-tab active" data-stab="general" role="tab">General</button>
      <button class="settings-tab" data-stab="models" role="tab">Models</button>
      <button class="settings-tab" data-stab="auth" role="tab">Auth</button>
      <button class="settings-tab" data-stab="prompts" role="tab">Prompts</button>
      <button class="settings-tab" data-stab="mcp" role="tab">MCP</button>
    </div>
    <div class="settings-body">

      <!-- General Tab -->
      <div class="settings-panel active" data-stab="general">
        <label for="selTheme">Theme:</label>
        <select id="selTheme" onchange="applyTheme(this.value)">
          <option value="default">Default</option>
          <option value="lcars">LCARS</option>
        </select>

        <label for="selEngine">TTS Engine:</label>
        <select id="selEngine" onchange="ChangeLang(this)">
          <option value="standard">Standard</option>
          <option value="neural">Neural</option>
          <option value="generative">Generative</option>
          <option value="bark">Bark</option>
        </select>

        <label for="selVoice">Voice:</label>
        <select id="selVoice" onchange="ChangeLang(this)">
          <option value="Salli">English</option>
          <option value="Ruth">English (gen)</option>
          <option value="Seoyeon">Korean</option>
          <option value="Mia">Spanish</option>
          <option value="Tatyana">Ukrainian</option>
        </select>

        <label for="autoSpeak">Auto Speak:</label>
        <input type="checkbox" id="autoSpeak">
      </div>

      <!-- Models Tab -->
      <div class="settings-panel" data-stab="models">
        <label for="selModel">Model:</label>
        <select id="selModel" onchange="updateButton(); onModelSettingsChange()">
          <optgroup label="OpenAI">
            <option value="gpt-4o" title="gpt-4o">gpt-4o</option>
            <option value="gpt-4o-mini" title="gpt-4o-mini">gpt-4o-mini</option>
            <option value="o1" title="o1">o1</option>
            <option value="o1-preview" title="o1-preview">o1-preview</option>
            <option value="o1-mini" title="o1-mini">o1-mini</option>
            <option value="o3-mini" title="o3-mini">o3-mini</option>
            <option value="gpt-5-mini" title="gpt-5-mini">gpt-5-mini</option>
            <option value="latest" title="OpenAI latest model alias">latest</option>
          </optgroup>
          <optgroup label="GitHub Copilot">
            <option value="copilot-gpt-4o" title="GitHub Models GPT-4o">Copilot GPT-4o</option>
            <option value="copilot-gpt-4o-mini" title="GitHub Models GPT-4o Mini">Copilot GPT-4o Mini</option>
            <option value="copilot-o3-mini" title="GitHub Models o3-mini">Copilot o3-mini</option>
          </optgroup>
          <optgroup label="Copilot ACP">
            <option value="copilot-acp" title="Copilot via ACP Bridge — uses your Copilot license model">Copilot (ACP)</option>
          </optgroup>
          <optgroup label="Google">
            <option value="gemini" title="Google Gemini">Gemini 2.0 Flash</option>
          </optgroup>
          <optgroup label="Local">
            <option value="lm-studio" title="lm-studio">lm-studio</option>
          </optgroup>
          <optgroup label="Image Generation">
            <option value="dall-e-3" title="Image Generation">DALL-E 3</option>
          </optgroup>
        </select>

        <div id="modelOptions" class="model-options">
          <div id="opt-temperature" class="model-opt">
            <label for="sldTemperature">Temperature: <span id="tempValue">0.7</span></label>
            <input type="range" id="sldTemperature" min="0" max="2" step="0.1" value="0.7" oninput="document.getElementById('tempValue').textContent=this.value">
          </div>
          <div id="opt-maxTokens" class="model-opt">
            <label for="txtMaxTokens">Max Tokens:</label>
            <input type="number" id="txtMaxTokens" value="4096" min="1" max="128000">
          </div>
          <div id="opt-reasoningEffort" class="model-opt" style="display:none">
            <label for="selReasoningEffort">Reasoning Effort:</label>
            <select id="selReasoningEffort">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div id="opt-acpModel" class="model-opt" style="display:none">
            <label for="selACPModel">ACP Model:</label>
            <select id="selACPModel">
              <option value="" selected>Default (Copilot CLI setting)</option>
              <optgroup label="Claude">
                <option value="claude-sonnet-4.6">Claude Sonnet 4.6</option>
                <option value="claude-opus-4.6">Claude Opus 4.6</option>
                <option value="claude-opus-4.6-fast">Claude Opus 4.6 Fast</option>
                <option value="claude-sonnet-4.5">Claude Sonnet 4.5</option>
                <option value="claude-opus-4.5">Claude Opus 4.5</option>
                <option value="claude-haiku-4.5">Claude Haiku 4.5</option>
                <option value="claude-sonnet-4">Claude Sonnet 4</option>
              </optgroup>
              <optgroup label="GPT">
                <option value="gpt-5.3-codex">GPT-5.3 Codex</option>
                <option value="gpt-5.2-codex">GPT-5.2 Codex</option>
                <option value="gpt-5.2">GPT-5.2</option>
                <option value="gpt-5.1-codex-max">GPT-5.1 Codex Max</option>
                <option value="gpt-5.1-codex">GPT-5.1 Codex</option>
                <option value="gpt-5.1">GPT-5.1</option>
                <option value="gpt-5.1-codex-mini">GPT-5.1 Codex Mini</option>
                <option value="gpt-5-mini">GPT-5 Mini</option>
                <option value="gpt-4.1">GPT-4.1</option>
              </optgroup>
              <optgroup label="Gemini">
                <option value="gemini-3-pro-preview">Gemini 3 Pro Preview</option>
              </optgroup>
            </select>
          </div>
        </div>
      </div>

      <!-- Auth Tab -->
      <div class="settings-panel" data-stab="auth">
        <p class="auth-note">Keys are stored locally in your browser. They override config.json values.</p>

        <div class="auth-field">
          <label for="authOpenAI">OpenAI API Key:</label>
          <div class="auth-input-wrap">
            <input type="password" id="authOpenAI" placeholder="sk-..." autocomplete="off">
            <button type="button" class="auth-toggle" onclick="toggleAuthVis(this)" aria-label="Show/hide key">Show</button>
          </div>
        </div>

        <div class="auth-field">
          <label for="authGitHub">GitHub PAT (Copilot Models API):</label>
          <div class="auth-input-wrap">
            <input type="password" id="authGitHub" placeholder="ghp_... or github_pat_..." autocomplete="off">
            <button type="button" class="auth-toggle" onclick="toggleAuthVis(this)" aria-label="Show/hide key">Show</button>
          </div>
        </div>

        <div class="auth-field">
          <label for="txtACPBridgeUrl">ACP Bridge URL (Copilot CLI):</label>
          <div class="auth-input-wrap">
            <input type="text" id="txtACPBridgeUrl" placeholder="http://localhost:8888" autocomplete="off">
          </div>
          <p class="auth-note">For Copilot (ACP) model. Run <code>python3 tools/acp_bridge.py</code> locally.</p>
        </div>

        <div class="auth-field">
          <label for="authGemini">Google Gemini Key:</label>
          <div class="auth-input-wrap">
            <input type="password" id="authGemini" placeholder="AI..." autocomplete="off">
            <button type="button" class="auth-toggle" onclick="toggleAuthVis(this)" aria-label="Show/hide key">Show</button>
          </div>
        </div>

        <div class="auth-field">
          <label for="authGoogleSearch">Google Search Key:</label>
          <div class="auth-input-wrap">
            <input type="password" id="authGoogleSearch" placeholder="AI..." autocomplete="off">
            <button type="button" class="auth-toggle" onclick="toggleAuthVis(this)" aria-label="Show/hide key">Show</button>
          </div>
        </div>

        <div class="auth-field">
          <label for="authGoogleCX">Google Search CX ID:</label>
          <div class="auth-input-wrap">
            <input type="text" id="authGoogleCX" placeholder="Search Engine CX ID" autocomplete="off">
          </div>
        </div>

        <div class="auth-field">
          <label for="authGoogleVision">Google Vision Key:</label>
          <div class="auth-input-wrap">
            <input type="password" id="authGoogleVision" placeholder="AI..." autocomplete="off">
            <button type="button" class="auth-toggle" onclick="toggleAuthVis(this)" aria-label="Show/hide key">Show</button>
          </div>
        </div>

        <button type="button" class="auth-save" onclick="saveAuthKeys()">Save Keys</button>
      </div>

      <!-- Prompts Tab -->
      <div class="settings-panel" data-stab="prompts">
        <label for="selPers">Personality Preset:</label>
        <select id="selPers" aria-label="Select personality" onchange="applyPersonalityPreset()">
          <option value="default" title="Eva's Default Personality">Default</option>
          <option value="concise" title="Concise responses">Concise</option>
          <option value="advanced" title="Detailed responses">Advanced</option>
          <option value="terminal" title="Emulate a Linux Bash Shell">Linux Terminal</option>
          <option value="custom" title="Use your own prompt">Custom</option>
        </select>

        <label for="txtSystemPrompt">System / Developer Prompt:</label>
        <textarea id="txtSystemPrompt" rows="8" placeholder="Enter custom system instructions..."></textarea>
        <p class="prompt-hint">This prompt is sent as the system/developer message to the AI. Select a preset above or write your own.</p>
      </div>

      <!-- MCP Tab -->
      <div class="settings-panel" data-stab="mcp">
        <p class="auth-note">MCP (Model Context Protocol) servers extend the AI with tools for Azure, GitHub, and more. Requires the ACP bridge (<code>tools/acp_bridge.py</code>).</p>

        <div class="mcp-preset">
          <label>
            <input type="checkbox" id="mcpAzure"> <strong>Azure MCP Server</strong>
          </label>
          <p class="prompt-hint">Kusto/ADX queries, Storage, Key Vault, Monitor, Compute, 42+ Azure services.<br>
            Auth: <code>az login --use-device-code</code> (run on the bridge host).<br>
            Requires: <code>npx</code> (Node.js) on the bridge host.</p>
        </div>

        <div class="mcp-preset">
          <label>
            <input type="checkbox" id="mcpGitHub"> <strong>GitHub MCP Server</strong>
          </label>
          <p class="prompt-hint">Repos, issues, PRs, Actions, code search, Dependabot, and more.<br>
            Auth: Uses your GitHub PAT from the Auth tab.<br>
            Requires: <code>docker</code> on the bridge host.</p>
        </div>

        <div class="mcp-preset">
          <label>
            <input type="checkbox" id="mcpKusto"> <strong>Kusto MCP Server (ADX)</strong>
          </label>
          <p class="prompt-hint">Query Azure Data Explorer with KQL. List databases, tables, schemas, sample data.<br>
            Auth: Device code flow (works with personal Microsoft accounts, no Azure subscription needed).<br>
            Requires: <code>azure-identity</code> Python package on the bridge host.</p>
          <div id="mcpKustoConfig" style="margin-top:8px;margin-left:26px;display:none">
            <label for="mcpKustoCluster" style="font-size:12px">Cluster URL:</label>
            <input type="text" id="mcpKustoCluster" placeholder="https://kvc-xxx.region.kusto.windows.net" style="font-size:12px">
            <label for="mcpKustoDatabase" style="font-size:12px;margin-top:4px">Default Database:</label>
            <input type="text" id="mcpKustoDatabase" placeholder="(optional)" style="font-size:12px">
          </div>
        </div>

        <div id="mcpStatus" class="mcp-status"></div>

        <button type="button" class="auth-save" onclick="applyMCPConfig()">Apply MCP Config</button>
        <button type="button" class="auth-toggle" onclick="refreshMCPStatus()" style="margin-top:8px;width:100%;text-align:center">Refresh Status</button>
      </div>

    </div>
  </div>

    <!--  <p id="result"></p> -->
   </div>

    <audio id="audioPlayback" class="audio" controls aria-label="Audio playback">
      <source id="audioSource" type="audio/mp3" src="">
    </audio>

<!--    <p></p> -->
    
<div class="input-monitors-row">
  <aside id="lcarsMonitorsDock" class="lcars-monitors" aria-label="Monitors">
    <div id="lcarsMonitorTabs" role="tablist" aria-label="LCARS monitors tabs">
      <button class="monitor-tab active" data-tab="tokens" role="tab" aria-selected="true" title="Token usage">Tkns</button>
      <button class="monitor-tab" data-tab="net" role="tab" aria-selected="false" title="Network">Net</button>
      <button class="monitor-tab" data-tab="sys" role="tab" aria-selected="false" title="System">Sys</button>
      <button class="monitor-tab" data-tab="misc" role="tab" aria-selected="false" title="Misc">Misc</button>
    </div>
    <div id="lcarsMonitorPanels">
      <div class="monitor-panel active" data-tab="tokens" role="tabpanel">
        <div class="monitor-grid">
          <div class="monitor-card">
            <div class="monitor-title">Context fill</div>
            <div class="progress"><div class="bar" id="ctxFillBar" style="width:0%"></div></div>
            <div class="monitor-value" id="ctxFillText">0% (0 / 0)</div>
          </div>
          <div class="monitor-card">
            <div class="monitor-title">Model window</div>
            <div class="monitor-value" id="modelWindowText">—</div>
          </div>
          <div class="monitor-card">
            <div class="monitor-title">Messages tokens</div>
            <div class="monitor-value" id="messagesTokensText">0</div>
          </div>
          <div class="monitor-card">
            <div class="monitor-title">Last response</div>
            <div class="monitor-value" id="lastResponseTokensText">0</div>
          </div>
        </div>
      </div>
      <div class="monitor-panel" data-tab="net" role="tabpanel" aria-hidden="true">
        <div class="monitor-grid">
          <div class="monitor-card"><div class="monitor-title">Slot 1</div><div class="monitor-value">—</div></div>
          <div class="monitor-card"><div class="monitor-title">Slot 2</div><div class="monitor-value">—</div></div>
          <div class="monitor-card"><div class="monitor-title">Slot 3</div><div class="monitor-value">—</div></div>
          <div class="monitor-card"><div class="monitor-title">Slot 4</div><div class="monitor-value">—</div></div>
        </div>
      </div>
      <div class="monitor-panel" data-tab="sys" role="tabpanel" aria-hidden="true">
        <div class="monitor-grid one-col">
          <div class="monitor-card monitor-terminal">
            <div id="idText" class="status-info">Config not loaded. Use config.local.js or run a local server.</div>
          </div>
        </div>
      </div>
      <div class="monitor-panel" data-tab="misc" role="tabpanel" aria-hidden="true">
        <div class="monitor-grid">
          <div class="monitor-card"><div class="monitor-title">Slot 1</div><div class="monitor-value">—</div></div>
          <div class="monitor-card"><div class="monitor-title">Slot 2</div><div class="monitor-value">—</div></div>
          <div class="monitor-card"><div class="monitor-title">Slot 3</div><div class="monitor-value">—</div></div>
          <div class="monitor-card"><div class="monitor-title">Slot 4</div><div class="monitor-value">—</div></div>
        </div>
      </div>
    </div>
  </aside>

  <div class="chat-input-container">
    <div id="txtMsg" contenteditable="true" rows="2" placeholder="Input Text" aria-label="Input text"></div>
    <div class="input-controls-window">
      <div class="input-controls">
        <div class="controls-top">
          <button type="button" id="uploadButton" class="lcars-btn" onclick="document.getElementById('imgInput').click()" aria-label="Upload image">Upload</button>
          <button type="button" onclick="startSpeechRecognition()" id="micButton" class="mic-button lcars-btn" aria-label="Start speech recognition">Mic</button>
        </div>
        <div class="controls-bottom">
          <button type="button" onclick="sendData()" id="btnSend" class="lcars-btn" aria-label="Send data">Send</button>
        </div>
      </div>
    </div>
    <input type="file" id="imgInput" aria-label="Upload image" style="display:none;">
    <script>
      insertImage();
    </script>
  </div>
</div>

    <script>
      // Capture CTRL + Enter Key
      shiftBreak();
    </script>

  <footer>
    <img id="eEgg" src="core/img/eEgg.gif" alt="Image" style="display:none;">
    <button id="settingsButton" style="margin: 1em;">Settings</button>
  <button id="printButton" onclick="printMaster()" aria-label="Print output">Print Output</button>
    <button id="clearMessagesBtn" onclick="clearMessages()" aria-label="Clear memory">Clear Memory</button>
  </footer> 

</body>
</html>
